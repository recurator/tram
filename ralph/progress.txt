# TRAM v0.2.0 Progress

Branch: ralph/tram-v0.2.0-intelligent-tuning
Started: 2026-02-03

## Stories

| ID | Title | Status |
|----|-------|--------|
| US-001 | Add minScore to injection config schema | ✅ complete |
| US-002 | Filter candidates by minScore in auto-recall | ✅ complete |
| US-003 | Expose full config schema to OpenClaw | ✅ complete |
| US-004 | Backward compatibility with boolean autoRecall | ✅ complete |
| US-005 | Add decay overrides config schema | ✅ complete |
| US-006 | Implement category-aware decay in DecayEngine | pending |
| US-007 | Add sessions config schema | pending |
| US-008 | Detect session type at runtime | pending |
| US-009 | Session-aware auto-capture | pending |
| US-010 | Session-aware default tier | pending |
| US-011 | Create injection_feedback table | pending |
| US-012 | Create tuning_log table | pending |
| US-013 | Track proxy metrics post-injection | pending |
| US-014 | Update access metrics on memory recall | pending |
| US-015 | Add tuning config schema | pending |
| US-016 | Add reporting config schema | pending |
| US-017 | Implement auto-adjustment logic | pending |
| US-018 | Log tuning changes | pending |
| US-019 | Implement user parameter lock | pending |
| US-020 | Implement notification delivery | pending |
| US-021 | Add memory_stats metrics dashboard | pending |
| US-022 | Create benchmark dataset | pending |
| US-023 | Implement benchmark runner | pending |
| US-024 | Document OpenClaw 2026.2.1 compatibility | pending |
| US-025 | Assess before_tool_call integration | pending |

## Codebase Patterns
- Config changes require updating: InjectionConfigSchema, ResolvedConfig interface, DEFAULTS, resolveConfig(), and uiHints
- The codebase uses Zod schemas for validation with corresponding TypeScript interfaces
- UI hints use specific types: "slider" for 0-1 ranges, "number" for counts, "toggle" for booleans
- AutoRecallHook uses MemoryScorer for composite scoring; to filter by score, call scorer.score() directly before allocation
- Tests for auto_recall use mocked database, embedding provider, and vector helper
- For union types (boolean | object), use z.union([z.boolean(), ObjectSchema]) and resolve in resolveConfig()
- ResolvedConfig interfaces should have all fields required (not optional) to ensure type safety
- createAutoRecallHook extracts all settings from resolved config.autoRecall object (not raw config)

## Log

## 2026-02-03 - US-001
- What was implemented: Added minScore configuration option to InjectionConfigSchema
- Files changed: config.ts
- **Learnings for future iterations:**
  - Config additions follow a 5-part pattern: schema field, ResolvedConfig interface, DEFAULTS, resolveConfig(), uiHints
  - Default values live in DEFAULTS constant (~line 198), not in schema defaults alone
  - uiHints sliders should have min/max/step defined for 0-1 range values
---

## 2026-02-03 - US-002
- What was implemented: Added minScore filtering to auto-recall hook before tier budget allocation
- Files changed: hooks/auto_recall.ts, __tests__/auto_recall.test.ts (new)
- **Learnings for future iterations:**
  - AutoRecallConfig interface must include new config options for them to be passed through
  - Filtering must happen BEFORE calling allocator.allocate() to affect tier budgets correctly
  - The scorer is already available as this.scorer in AutoRecallHook
  - Use >= not > for threshold comparisons to include memories at exact threshold
  - Empty result handling requires checking for current context before returning
  - createAutoRecallHook() factory function also needs updating to pass new config options
---

## 2026-02-03 - US-003
- What was implemented: Verified and documented that full config schema is exposed to OpenClaw
- Files changed: README.md (added injection.minScore documentation)
- **Learnings for future iterations:**
  - The configSchema export in index.ts includes both the Zod schema and uiHints
  - uiHints already covers all config sections: injection.*, scoring.*, tiers.*, decay.*
  - The configSchema.parse() is used in register() to parse and validate config from openclaw.json
  - README should document all config options to help users discover them
---

## 2026-02-03 - US-004
- What was implemented: Backward compatibility allowing autoRecall to be boolean or object
- Files changed: config.ts, hooks/auto_recall.ts, __tests__/config.test.ts (new)
- **Learnings for future iterations:**
  - Use z.union([z.boolean(), ObjectSchema]) for backward-compatible config options
  - Create a dedicated resolve function (resolveAutoRecall) to handle union type normalization
  - The ResolvedConfig interface should always use the fully-resolved object type, never the union
  - When the object form has optional values, fall back to injection config (not defaults) for DRY
  - Test backward compatibility explicitly: boolean true, boolean false, object with partial values, full v0.1.x configs
  - Empty object {} should be valid input, relying on defaults from injection config
---

## 2026-02-03 - US-005
- What was implemented: Added decay overrides config schema with per-memory-type TTLs
- Files changed: config.ts
- **Learnings for future iterations:**
  - Use z.record(MemoryTypeSchema, ValueSchema) for type-keyed maps with constrained keys
  - For nullable values, use z.union([z.number().min(1), z.null()]) to allow null or positive numbers
  - Create separate schemas for nested objects (DecayTTLOverrideSchema, DecayDefaultsSchema) for clarity
  - The MemoryTypeSchema must exactly match MemoryType enum values from core/types.ts
  - Default value for overrides should be an empty object {} cast to the proper type
  - uiHints for nested objects with per-type fields require explicit field definitions for each type
---

